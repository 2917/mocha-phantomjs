<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>mocha-phantomjs by metaskills</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">mocha-phantomjs</h1>
        <p class="header">PhantomJS Runners for Mocha</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/metaskills/mocha-phantomjs/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/metaskills/mocha-phantomjs/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/metaskills/mocha-phantomjs">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/metaskills">metaskills</a></p>


      </header>
      <section>
        <h1>PhantomJS Runners for Mocha</h1>

<p><a href="http://visionmedia.github.com/mocha/">Mocha</a> is a feature-rich JavaScript test framework running on node and the browser. Along with the <a href="http://chaijs.com">Chai</a> assertion library they make an impressive combo. <a href="http://phantomjs.org">PhantomJS</a> is a headless WebKit with a JavaScript/CoffeeScript API. It has fast and native support for various web standards like DOM handling, CSS selectors, JSON, Canvas, and SVG.</p>

<p>The mocha-phantomjs project provides a <code>mocha-phantomjs.coffee</code> script file and extensions to drive PhantomJS while testing your HTML pages with Mocha form the console.</p>

<h1>Key Features</h1>

<h3>Standard Out</h3>

<p>Finally, <code>process.stdout.write</code>, done right. Mocha is primarily written for node, hence it relies on writing to standard out without trailing newline characters. This behavior is critical for reporters like the dot reporter. We make up for PhantomJS's lack of stream support by both customizing <code>console.log</code> and creating a <code>process.stdout.write</code> function to the current PhantomJS process. This technique combined with a handful of fancy <a href="http://web.mit.edu/gnu/doc/html/screen_10.html">ANSI cursor movement codes</a> allows PhantomJS to support Mocha's diverse reporter options.</p>

<h3>Exit Codes</h3>

<p>Proper exit status codes from PhantomJS using Mocha's failures. The number of Mocha's test failures from Mocha will be the return code. So in standard UNIX fashion, a <code>0</code> code means success. This means you can use mocha-phantomjs on your CI server of choice.</p>

<h3>Mixed Mode Runs</h3>

<p>Mixed mode HTML file support. Meaning you can use your existing Mocha HTML file reporters side by side with mocha-phantomjs. This gives you the option to run your tests both in a browser or with PhantomJS. Since mocha-phantomjs needs to control when the <code>run()</code> command is sent to the mocha object, we accomplish this by setting the <code>mochaPhantomJS</code> on the <code>window</code> object to <code>true</code>. Here is an example of a HTML structure that can be used both by opening the file in your browser or choice or using mocha-phantomjs. See the usage section below for an example of how to use this feature.</p>

<h1>Usage</h1>

<pre><code>$ phantomjs mocha-phantomjs.coffee URL [REPORTER]
</code></pre>

<p>The <code>mocha-phantomjs.coffee</code> script needs to be accompanied by the <code>mocha-phantomjs</code> directory included in the Github's <code>lib</code> project directory. This directory contains core extensions the script needs to inject into the loaded URL. If the <code>mocha-phantomjs.coffee</code> file resides directly beside this directory, everything should just work.</p>

<p>Your HTML file structure should look something like this. The reporter set below to <code>html</code> is only needed for viewing the HTML page in your browser. The <code>mocha-phantomjs.coffee</code> script overrides that reporter value. The conditional run allows the mixed mode described above.</p>

<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"mocha.css"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"mocha"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"mocha.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"chai.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">mocha</span><span class="p">.</span><span class="nx">ui</span><span class="p">(</span><span class="s1">'bdd'</span><span class="p">);</span> 
      <span class="nx">mocha</span><span class="p">.</span><span class="nx">reporter</span><span class="p">(</span><span class="s1">'html'</span><span class="p">);</span>
      <span class="nx">expect</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">expect</span><span class="p">;</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"test/mycode.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">mochaPhantomJS</span><span class="p">)</span> <span class="p">{</span> <span class="nx">mocha</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span> <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<h1>Supported Reporters</h1>

<p>No other Mocha/PhantomJS runner does what this project does. Some used a debounce method to keep duplicate messages in the spec reporter from showing up twice. But this came at a cost, loosing one of Mocha's console reporters neatest features, initial test start feedback. The animation below is an example of how out runner script fully compiles with expected Mocha behavior.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/slow.gif" alt="Slow Tests Example"> 

<p>The following is a list of supported runners. If you do not see one that you really want, fork the repo and try to write the <code>customizeProcessStdout()</code> and <code>customizeConsole()</code> functions to support that runner. If you need help, <a href="https://github.com/metaskills/mocha-phantomjs/issues">create a github issue</a> and let me know.</p>

<h3>Spec Reporter (default)</h3>

<p>The default reporter. You can force it using <code>spec</code> for the reporter argument.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_spec.gif" alt="Spec Reporter" width="616"> 

<h3>Dot Matrix Reporter</h3>

<p>Use <code>dot</code> for the reporter argument.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_dot.gif" alt="Dot Matrix Reporter" width="616"> 

<p>The PhantomJS process has no way of knowing anything about your console window's width. So we default the width to 75 columns. But if you pass down the <code>COLUMNS</code> environment variable, it will pick that up and adjust to your current terminal width. For example, using the <code>$COLUMNS</code> variable like so.</p>

<pre><code>env COLUMNS=$COLUMNS phantomjs mocha-phantomjs.coffee URL dot
</code></pre>

<h3>TAP Reporter</h3>

<p>Use <code>tap</code> for the reporter argument.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_tap.gif" alt="TAP Reporter" width="616"> 

<h3>Min Reporter</h3>

<p>Use <code>min</code> for the reporter argument.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_min.gif" alt="Min Reporter" width="616"> 

<h3>List Reporter</h3>

<p>Use <code>list</code> for the reporter argument.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_list.gif" alt="List Reporter" width="616"> 

<h3>Doc Reporter</h3>

<p>Use <code>doc</code> for the reporter argument.</p>

 
  <img src="https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_doc.gif" alt="Doc Reporter" width="616"> 

<h1>Testing</h1>

<p>Simple! Just clone the repo, then run <code>npm install</code> and the various node development dependencies will install to the <code>node_modules</code> directory of the project. If you have not done so, it is typically a good idea to add <code>/node_modules/.bin</code> to your <code>$PATH</code> so these modules bins are used. Now run <code>cake test</code> to start off the test suite.</p>

<p>We also use Travis CI to run our tests too. The current build status:</p>

<p><a href="http://travis-ci.org/metaskills/mocha-phantomjs"><img src="https://secure.travis-ci.org/metaskills/mocha-phantomjs.png" alt="Build Status"></a></p>

<h1>TODO</h1>

<ul>
<li>Create a <code>mocha-phantomjs</code> bin file for use in Node.js and publish a NPM.</li>
</ul><h1>Alternatives</h1>

<ul>
<li>OpenPhantomScripts - <a href="https://github.com/mark-rushakoff/OpenPhantomScripts">https://github.com/mark-rushakoff/OpenPhantomScripts</a>
</li>
<li>Front Tests - <a href="https://github.com/Backbonist/front-tests">https://github.com/Backbonist/front-tests</a>
</li>
</ul><h1>License</h1>

<p>Released under the MIT license. Copyright (c) 2012 Ken Collins.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-34687749-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>