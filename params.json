{"name":"mocha-phantomjs","tagline":"PhantomJS Runners for Mocha","body":"# PhantomJS Runners for Mocha\r\n\r\n[Mocha](http://visionmedia.github.com/mocha/) is a feature-rich JavaScript test framework running on node and the browser. Along with the [Chai](http://chaijs.com) assertion library they make an impressive combo. [PhantomJS](http://phantomjs.org) is a headless WebKit with a JavaScript/CoffeeScript API. It has fast and native support for various web standards like DOM handling, CSS selectors, JSON, Canvas, and SVG.\r\n\r\nThe mocha-phantomjs project provides a `mocha-phantomjs.coffee` script file and extensions to drive PhantomJS while testing your HTML pages with Mocha from the console. The preferred usage is to install `mocha-phantomjs` via node's packaged modules and use the `mocha-phantomjs` binary wrapper. Tested with Mocha 1.8, Chai 1.5, and PhantomJS 1.9. The latest of these versions is recommended!\r\n\r\n[![Build Status](https://secure.travis-ci.org/metaskills/mocha-phantomjs.png)](http://travis-ci.org/metaskills/mocha-phantomjs)\r\n\r\n\r\n# Key Features\r\n\r\n### Standard Out\r\n\r\nFinally, `process.stdout.write`, done right. Mocha is primarily written for node, hence it relies on writing to standard out without trailing newline characters. This behavior is critical for reporters like the dot reporter. We make up for PhantomJS's lack of stream support by both customizing `console.log` and creating a `process.stdout.write` function to the current PhantomJS process. This technique combined with a handful of fancy [ANSI cursor movement codes](http://web.mit.edu/gnu/doc/html/screen_10.html) allows PhantomJS to support Mocha's diverse reporter options.\r\n\r\n### Exit Codes\r\n\r\nProper exit status codes from PhantomJS using Mocha's failures count. So in standard UNIX fashion, a `0` code means success. This means you can use mocha-phantomjs on your CI server of choice.\r\n\r\n### Mixed Mode Runs\r\n\r\nYou can use your existing Mocha HTML file reporters side by side with mocha-phantomjs. This gives you the option to run your tests both in a browser or with PhantomJS. Since mocha-phantomjs needs to control when the `run()` command is sent to the mocha object, we accomplish this by setting the `mochaPhantomJS` on the `window` object to `true`. Below, in the usage section, is an example of a HTML structure that can be used both by opening the file in your browser or choice or using mocha-phantomjs.\r\n\r\n\r\n# Installation\r\n\r\nWe distribute [mocha-phantomjs as an npm](https://npmjs.org/package/mocha-phantomjs) that is easy to install. Once done, you will have a `mocha-phantomjs` binary. See the next usage section for docs or use the `-h` flag.\r\n\r\nWe have an undeclared dependency on PhantomJS. This allows you to choose to install PhantomJS via the node package manager (npm),\r\nor to use system PhantomJS downloaded and installed from [the PhantomJS website](http://phantomjs.org).\r\n\r\nIf you would like to use PhantomJS installed from npm:\r\n\r\n```\r\n$ npm install -g mocha-phantomjs phantomjs\r\n```\r\n\r\nOtherwise, once you have downloaded and installed PhantomJS yourself:\r\n\r\n```\r\n$ npm install -g mocha-phantomjs\r\n```\r\n\r\nIf you don't install phantomjs using either of these approaches, you will get an unhelpful **ENOENT** error when you try to run `mocha-phantomjs`.\r\n\r\n# Usage\r\n\r\n```\r\nUsage: mocha-phantomjs [options] page\r\n\r\n Options:\r\n\r\n   -h, --help                   output usage information\r\n   -V, --version                output the version number\r\n   -R, --reporter <name>        specify the reporter to use\r\n   -t, --timeout <timeout>      specify the test startup timeout to use\r\n   -A, --agent <userAgent>      specify the user agent to use\r\n   -c, --cookies <Object>       phantomjs cookie object http://git.io/RmPxgA\r\n   -h, --header <name>=<value>  specify custom header\r\n   -s, --setting <key>=<value>  specify phantomjs WebPage settings\r\n   -v, --view <width>x<height>  specify phantomjs viewport size\r\n   -C, --no-color               disable color escape codes\r\n   -p, --path <path>            path to PhantomJS binary\r\n\r\n Examples:\r\n\r\n   $ mocha-phantomjs -R dot /test/file.html\r\n   $ mocha-phantomjs http://testserver.com/file.html\r\n   $ mocha-phantomjs -s localToRemoteUrlAccessEnabled=true -s webSecurityEnabled=false http://testserver.com/file.html\r\n   $ mocha-phantomjs -p ~/bin/phantomjs /test/file.html\r\n```\r\n\r\nNow as an node package, using `mocha-phantomjs` has never been easier. The page argument can be either a local or fully qualified path or a http or file URL. See the list of reporters below for acceptable options to the `--reporter` argument. See [phantomjs WebPage settings](https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage#wiki-webpage-settings) for options that may be supplied to the `--setting` argument.\r\n\r\nYour HTML file's structure should look something like this. The reporter set below to `html` is only needed for viewing the HTML page in your browser. The `mocha-phantomjs.coffee` script overrides that reporter value. The conditional run at the bottom allows the mixed mode feature described above.\r\n\r\n```html\r\n<html>\r\n  <head>\r\n    <meta charset=\"utf-8\">\r\n    <link rel=\"stylesheet\" href=\"mocha.css\" />\r\n  </head>\r\n  <body>\r\n    <div id=\"mocha\"></div>\r\n    <script src=\"mocha.js\"></script>\r\n    <script src=\"chai.js\"></script>\r\n    <script>\r\n      mocha.ui('bdd');\r\n      mocha.reporter('html');\r\n      expect = chai.expect;\r\n    </script>\r\n    <script src=\"test/mycode.js\"></script>\r\n    <script>\r\n      if (window.mochaPhantomJS) { mochaPhantomJS.run(); }\r\n      else { mocha.run(); }\r\n    </script>\r\n  </body>\r\n</html>\r\n```\r\n\r\n\r\n# Supported Reporters\r\n\r\nMocha-phantomjs does not scrap the web page under test! No other PhantomJS driver stacks up to our runner support. Some have used a debounce method to keep duplicate messages in the spec reporter from showing up twice. Loosing one of Mocha's console reporters neatest features, initial test start feedback. The animation below is an example of how our runner script fully compiles with expected Mocha behavior.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/slow.gif\" alt=\"Slow Tests Example\">\r\n</div>\r\n\r\nThe following is a list of supported runners. If you do not see one that you really want, fork the repo and try to write the `customizeProcessStdout()` and `customizeConsole()` functions to support that runner. If you need help, [create a github issue](https://github.com/metaskills/mocha-phantomjs/issues) and let me know.\r\n\r\n### Spec Reporter (default)\r\n\r\nThe default reporter. You can force it using `spec` for the reporter argument.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_spec.gif\" alt=\"Spec Reporter\" width=\"616\">\r\n</div>\r\n\r\n### Dot Matrix Reporter\r\n\r\nUse `dot` for the reporter argument.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_dot.gif\" alt=\"Dot Matrix Reporter\" width=\"616\">\r\n</div>\r\n\r\nThe PhantomJS process has no way of knowing anything about your console window's width. So we default the width to 75 columns. But if you pass down the `COLUMNS` environment variable, it will pick that up and adjust to your current terminal width. For example, using the `$COLUMNS` variable like so.\r\n\r\n```\r\nenv COLUMNS=$COLUMNS phantomjs mocha-phantomjs.coffee URL dot\r\n```\r\n\r\n### TAP Reporter\r\n\r\nUse `tap` for the reporter argument.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_tap.gif\" alt=\"TAP Reporter\" width=\"616\">\r\n</div>\r\n\r\n### Min Reporter\r\n\r\nUse `min` for the reporter argument.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_min.gif\" alt=\"Min Reporter\" width=\"616\">\r\n</div>\r\n\r\n### List Reporter\r\n\r\nUse `list` for the reporter argument.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_list.gif\" alt=\"List Reporter\" width=\"616\">\r\n</div>\r\n\r\n### Doc Reporter\r\n\r\nUse `doc` for the reporter argument.\r\n\r\n<div style=\"text-align:center;\">\r\n  <img src=\"https://raw.github.com/metaskills/mocha-phantomjs/master/public/images/reporter_doc.gif\" alt=\"Doc Reporter\" width=\"616\">\r\n</div>\r\n\r\n### TeamCity Reporter\r\n\r\nUse `teamcity` for the reporter argument.\r\n\r\n```\r\n$ phantomjs lib/mocha-phantomjs.coffee test/passing.html teamcity\r\n##teamcity[testSuiteStarted name='mocha.suite']\r\n##teamcity[testStarted name='Tests Passing passes 1']\r\n##teamcity[testFinished name='Tests Passing passes 1' duration='0']\r\n##teamcity[testStarted name='Tests Passing passes 2']\r\n##teamcity[testFinished name='Tests Passing passes 2' duration='0']\r\n##teamcity[testStarted name='Tests Passing passes 3']\r\n##teamcity[testFinished name='Tests Passing passes 3' duration='0']\r\n##teamcity[testIgnored name='Tests Passing skips 1' message='pending']\r\n##teamcity[testFinished name='Tests Passing skips 1' duration='undefined']\r\n##teamcity[testIgnored name='Tests Passing skips 2' message='pending']\r\n##teamcity[testFinished name='Tests Passing skips 2' duration='undefined']\r\n##teamcity[testIgnored name='Tests Passing skips 3' message='pending']\r\n##teamcity[testFinished name='Tests Passing skips 3' duration='undefined']\r\n##teamcity[testSuiteFinished name='mocha.suite' duration='133']\r\n```\r\n\r\n### JSON Reporter\r\n\r\nUse `json` for the reporter argument.\r\n\r\n```\r\n$ phantomjs lib/mocha-phantomjs.coffee test/passing.html json\r\n{\r\n  \"stats\": {\r\n    \"suites\": 1,\r\n    \"tests\": 6,\r\n    \"passes\": 3,\r\n    \"pending\": 3,\r\n    \"failures\": 0,\r\n  ...\r\n```\r\n\r\n### JSONCov Reporter\r\n\r\nUse `json-cov` for the reporter argument. I have not tested these as they require the [node-jscoverage](https://github.com/visionmedia/node-jscoverage) tool to be used.\r\n\r\n```\r\n$ phantomjs lib/mocha-phantomjs.coffee test/passing.html json-cov\r\n{\r\n  \"instrumentation\": \"node-jscoverage\",\r\n  \"sloc\": 0,\r\n  \"hits\": 0,\r\n  \"misses\": 0,\r\n  \"coverage\": 0,\r\n  \"files\": [],\r\n  \"stats\": {\r\n    \"suites\": 1,\r\n    \"tests\": 6,\r\n    \"passes\": 3,\r\n    \"pending\": 3,\r\n    ...\r\n```\r\n\r\n### HTMLCov Reporter\r\n\r\nUse `html-cov` for the reporter argument. I have not tested these as they require the [node-jscoverage](https://github.com/visionmedia/node-jscoverage) tool to be used.\r\n\r\n### XUnit Reporter\r\n\r\nUse `xunit` for the reporter argument.\r\n\r\n```\r\n<testsuite name=\"Mocha Tests\" tests=\"18\" failures=\"6\" errors=\"6\" skip=\"6\" timestamp=\"Sun, 21 Oct 2012 17:29:59 GMT\" time=\"0.36\">\r\n<testcase classname=\"Tests Mixed\" name=\"passes 1\" time=\"0\"/>\r\n<testcase classname=\"Tests Mixed\" name=\"passes 2\" time=\"0.001\"/>\r\n<testcase classname=\"Tests Mixed\" name=\"passes 3\" time=\"0\"/>\r\n...\r\n```\r\n\r\n\r\n# Testing\r\n\r\nSimple! Just clone the repo, then run `npm install` and the various node development dependencies will install to the `node_modules` directory of the project. If you have not done so, it is typically a good idea to add `/node_modules/.bin` to your `$PATH` so these modules bins are used. Now run `cake test` to start off the test suite.\r\n\r\nWe also use Travis CI to run our tests too. The current build status:\r\n\r\n[![Build Status](https://secure.travis-ci.org/metaskills/mocha-phantomjs.png)](http://travis-ci.org/metaskills/mocha-phantomjs)\r\n\r\n\r\n# TODO\r\n\r\n* Create a `mocha-phantomjs` bin file for use in Node.js and publish a NPM.\r\n\r\n\r\n# Alternatives\r\n\r\n* OpenPhantomScripts - https://github.com/mark-rushakoff/OpenPhantomScripts\r\n* Front Tests - https://github.com/Backbonist/front-tests\r\n\r\n\r\n# License\r\n\r\nReleased under the MIT license. Copyright (c) 2012 Ken Collins.\r\n\r\n","google":"UA-34687749-1","note":"Don't delete this file! It's used internally to help with page regeneration."}